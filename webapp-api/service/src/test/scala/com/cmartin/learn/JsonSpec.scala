package com.cmartin.learn

import com.cmartin.learn.service.spec.Artifact
import org.json4s._
import org.json4s.native.JsonMethods._
import org.scalatest.{FlatSpec, Matchers}

class JsonSpec extends FlatSpec with Matchers {

  implicit lazy val formats = DefaultFormats

  val artifactsJson =
    """
      {"totalCount":57,"from":-1,"count":-1,"tooManyResults":false,"collapsed":false,"repoDetails":[{"repositoryId":"xxxxx-releases-lib","repositoryName":"Maven - Mutua Releases Lib","repositoryContentClass":"maven2","repositoryKind":"hosted","repositoryPolicy":"RELEASE","repositoryURL":"http://srxmdesarepo.xxxxx.es:8080/nexus/service/local/repositories/xxxxx-releases-lib"}],"data":[{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"5.2.1","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"5.2.0","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"5.1.0","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"4.8.0","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"4.7.1","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"4.6.0","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"4.5.1","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"4.5.0","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"4.4.0","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"4.3.0","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"4.2.0","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"4.1.1","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"4.1.0","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"4.1.0-RC1","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"4.0.0","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"3.5.3","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"3.5.2","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"3.5.1","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"3.5.0","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"3.4.0","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"3.3.0","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"3.2.0","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"3.1.0","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"3.0.0","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"2.3.0","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"2.2.1","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"2.0.1","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"2.0.0","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"jar"},{"classifier":"sources","extension":"jar"}]}]},{"groupId":"es.mma.architecture","artifactId":"mma-arch-base","version":"1.0.13","latestRelease":"5.2.1","latestReleaseRepositoryId":"xxxxx-releases-lib","artifactHits":[{"repositoryId":"xxxxx-releases-lib","artifactLinks":[{"extension":"pom"},{"extension":"pom"}]}]}]}
    """.stripMargin


  val filesJson =
    """
      |{"data":[{"resourceURI":"http://srxmdesarepo.xxxxx.es:8080/nexus/service/local/repositories/xxxxx-releases-lib/content/es/mma/architecture/mma-arch-base/5.2.1/mma-arch-base-5.2.1-sources.jar","relativePath":"/es/mma/architecture/mma-arch-base/5.2.1/mma-arch-base-5.2.1-sources.jar","text":"mma-arch-base-5.2.1-sources.jar","leaf":true,"lastModified":"2018-09-06 09:46:40.0 UTC","sizeOnDisk":65776},{"resourceURI":"http://srxmdesarepo.xxxxx.es:8080/nexus/service/local/repositories/xxxxx-releases-lib/content/es/mma/architecture/mma-arch-base/5.2.1/mma-arch-base-5.2.1.jar.md5","relativePath":"/es/mma/architecture/mma-arch-base/5.2.1/mma-arch-base-5.2.1.jar.md5","text":"mma-arch-base-5.2.1.jar.md5","leaf":true,"lastModified":"2018-09-06 09:46:40.0 UTC","sizeOnDisk":32},{"resourceURI":"http://srxmdesarepo.xxxxx.es:8080/nexus/service/local/repositories/xxxxx-releases-lib/content/es/mma/architecture/mma-arch-base/5.2.1/mma-arch-base-5.2.1.jar","relativePath":"/es/mma/architecture/mma-arch-base/5.2.1/mma-arch-base-5.2.1.jar","text":"mma-arch-base-5.2.1.jar","leaf":true,"lastModified":"2018-09-06 09:46:40.0 UTC","sizeOnDisk":111050},{"resourceURI":"http://srxmdesarepo.xxxxx.es:8080/nexus/service/local/repositories/xxxxx-releases-lib/content/es/mma/architecture/mma-arch-base/5.2.1/mma-arch-base-5.2.1.pom","relativePath":"/es/mma/architecture/mma-arch-base/5.2.1/mma-arch-base-5.2.1.pom","text":"mma-arch-base-5.2.1.pom","leaf":true,"lastModified":"2018-09-06 09:46:40.0 UTC","sizeOnDisk":6252},{"resourceURI":"http://srxmdesarepo.xxxxx.es:8080/nexus/service/local/repositories/xxxxx-releases-lib/content/es/mma/architecture/mma-arch-base/5.2.1/mma-arch-base-5.2.1.pom.sha1","relativePath":"/es/mma/architecture/mma-arch-base/5.2.1/mma-arch-base-5.2.1.pom.sha1","text":"mma-arch-base-5.2.1.pom.sha1","leaf":true,"lastModified":"2018-09-06 09:46:40.0 UTC","sizeOnDisk":40},{"resourceURI":"http://srxmdesarepo.xxxxx.es:8080/nexus/service/local/repositories/xxxxx-releases-lib/content/es/mma/architecture/mma-arch-base/5.2.1/mma-arch-base-5.2.1.pom.md5","relativePath":"/es/mma/architecture/mma-arch-base/5.2.1/mma-arch-base-5.2.1.pom.md5","text":"mma-arch-base-5.2.1.pom.md5","leaf":true,"lastModified":"2018-09-06 09:46:40.0 UTC","sizeOnDisk":32},{"resourceURI":"http://srxmdesarepo.xxxxx.es:8080/nexus/service/local/repositories/xxxxx-releases-lib/content/es/mma/architecture/mma-arch-base/5.2.1/mma-arch-base-5.2.1-sources.jar.md5","relativePath":"/es/mma/architecture/mma-arch-base/5.2.1/mma-arch-base-5.2.1-sources.jar.md5","text":"mma-arch-base-5.2.1-sources.jar.md5","leaf":true,"lastModified":"2018-09-06 09:46:40.0 UTC","sizeOnDisk":32},{"resourceURI":"http://srxmdesarepo.xxxxx.es:8080/nexus/service/local/repositories/xxxxx-releases-lib/content/es/mma/architecture/mma-arch-base/5.2.1/mma-arch-base-5.2.1.jar.sha1","relativePath":"/es/mma/architecture/mma-arch-base/5.2.1/mma-arch-base-5.2.1.jar.sha1","text":"mma-arch-base-5.2.1.jar.sha1","leaf":true,"lastModified":"2018-09-06 09:46:40.0 UTC","sizeOnDisk":40},{"resourceURI":"http://srxmdesarepo.xxxxx.es:8080/nexus/service/local/repositories/xxxxx-releases-lib/content/es/mma/architecture/mma-arch-base/5.2.1/mma-arch-base-5.2.1-sources.jar.sha1","relativePath":"/es/mma/architecture/mma-arch-base/5.2.1/mma-arch-base-5.2.1-sources.jar.sha1","text":"mma-arch-base-5.2.1-sources.jar.sha1","leaf":true,"lastModified":"2018-09-06 09:46:40.0 UTC","sizeOnDisk":40}]}
    """.stripMargin

  "Json4s parse" should "retrieve an artifact list" in {
    // TODO mangage MappingException
    val children = (parse(artifactsJson) \\ "data").children
    val artifacts: List[Artifact] = children.map(extractArtifact(_))
    artifacts.nonEmpty shouldEqual (true)

    val artifact = artifacts.head
    artifact.g.nonEmpty shouldEqual (true)
    artifact.a.nonEmpty shouldEqual (true)
    artifact.v.nonEmpty shouldEqual (true)
  }



  def extractArtifact(value: JValue): Artifact = {
    Artifact((value \ "groupId").extract[String], (value \ "artifactId").extract[String], (value \ "version").extract[String])
  }

}
